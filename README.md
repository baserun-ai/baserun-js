# Baserun

**[Baserun](https://baserun.ai)** is the collaborative workspace for AI teams. Our mission is to simplify the testing, debugging, and evaluation of LLM features to help you get your app production-ready.

## Quick Start

Install `baserun`

```bash
npm install baserun --save-dev
# or
yarn add baserun --dev
```

Get your API key from the [Baserun dashboard](https://baserun.ai/settings) and set it as an environment variable:

```bash
export BASERUN_API_KEY="your_api_key_here"
```

Use our Jest preset and start immediately logging to Baserun. By default all OpenAI completion and chat requests will be logged to Baserun. Logs are aggregated by test.

```typescript
// test_module.spec.ts

import OpenAI from "openai";

const openai = new OpenAI({
  apiKey: process.env.OPENAI_API_KEY,
});

describe('Baserun end-to-end', () => {
  it('should suggest the Eiffel Tower', async () => {
    const chatCompletion = await openai.chat.completions.create({
      model: "gpt-3.5-turbo",
      temperature: 0.7,
      messages: [
        {
          role: "user",
          content: "What are three activities to do in Paris?"
        }
      ],
    });

    expect(chatCompletion.choices[0].message!.content!).toContain('Eiffel Tower');
  });
});
```

To run the test and log to baserun:

```bash
jest --preset baserun test_module.spec.ts
...
========================Baserun========================
Test results available at: https://baserun.ai/runs/<id>
=======================================================
```

### Existing presets

If you are already using a Jest preset such as ts-jest you will need to merge the presets in a Jest config

```js
// jest.config.js or jest.config.baserun.js

const tsPreset = require('ts-jest/jest-preset')
const baserunPreset = require('baserun/jest-preset')

module.exports = {
    ...tsPreset,
    ...baserunPreset,
    testTimeout: 10000,
}
```

Then to run a test and log to baserun:

```bash
jest test_modules.spec.ts
...
========================Baserun========================
Test results available at: https://baserun.ai/runs/<id>
=======================================================
```


## Custom logs

### log
Logs a custom message to Baserun. If Baserun is not initialized, this function will have no effect.

#### Parameters
* message (string): The custom log message to be recorded.
* payload (string | object): The log's additional data, which can be either a string or an object.

```typescript
import { baserun } from 'baserun';

describe("Baserun end-to-end tests", () => {
  it('should log custom events', () => {
    ...
    baserun.log("CustomEvent", { key: "value" });
  });
})
```

## Production monitoring with baserun.trace

### trace
Aggregates a trace of all logs generated by a function call to Baserun. By default all OpenAI completion and chat requests will be logged as part of the trace. If Baserun is not initialized, baserun.trace will have no effect.

#### Parameters
* function (Function): The function to be traced.
* metadata (object, optional): Additional metadata to record alongside the traced logs.

### Initialization
Add your BASERUN_API_KEY as an environment variable and then initialize Baserun at the entry point of your application.

```typescript
import { baserun } from 'baserun';

if (process.env.NODE_ENV === 'production') {
  baserun.init();
}
```

Then wrap the function that you would like to trace:

```typescript
import { baserun } from 'baserun';

const traceGetResponse = baserun.trace(aiService.getResponse, {userId: 123});
const response = await traceGetResponse(message);
```